(function(o,n,T,l,z,v,R,N,r){"use strict";function u(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var i=u(v),w=u(R);const m=l.findByDisplayName("FormText"),C=l.findByDisplayName("Switch"),F=l.findByDisplayName("TextInput");l.findByDisplayName("Select",!1).SingleSelect;const d=e=>({display:"flex",alignItems:"center",gap:".5rem",marginBottom:"1rem",marginLeft:e!==void 0?"1rem":0}),f=({k:e,depends:t,children:s})=>i.default.createElement("div",{style:d(t)},i.default.createElement(C,{checked:n.persist.ghost[e],disabled:t!==void 0&&!n.persist.ghost[t],onChange:c=>n.persist.store[e]=c}),i.default.createElement(m,{children:s})),g=({k:e,depends:t,children:s})=>i.default.createElement("div",{style:d(t)},i.default.createElement(F,{value:n.persist.ghost[e],disabled:t!==void 0&&!n.persist.ghost[t],onChange:c=>n.persist.store[e]=c}),i.default.createElement(m,{children:s})),I=e=>t=>(T.useNest(n.persist),e(t)),x=(e,t=n.persist)=>{for(const s in e)t.ghost[s]===void 0&&(t.store[s]=e[s])};var L=()=>N.injectCSS(".lastfm-settings-container .lastfm-status-card{width:100%;padding:20px;margin-bottom:1rem}.lastfm-settings-container .lastfm-status-card small{font-size:smaller}.lastfm-settings-container .lastfm-status-card h1{margin-bottom:.25rem}");const[V,p,h,y,{SingleSelect:Y},{showToast:O}]=l.batchFind(({findByProps:e,findByDisplayName:t})=>{e("Sizes","Colors","Looks","DropdownSizes"),t("Card"),t("FormText"),t("FormTitle"),t("Select",!1),e("showToast")});var k=I(()=>r.React.createElement("div",{className:"lastfm-settings-container"},r.React.createElement(p,{type:p.Types.PRIMARY,className:"lastfm-status-card"},r.React.createElement(y,{tag:y.Tags.H1},"Status"),r.React.createElement(h,{className:"lastfm-status",type:h.Types.DESCRIPTION},n.persist.ghost.status,r.React.createElement("br",null),r.React.createElement("small",null,"(Updates every 5 seconds)"))),r.React.createElement(f,{k:"enabled",depends:void 0},"Enable Last.fm Rich Presence"),r.React.createElement(g,{k:"username",depends:"enabled"},"Last.fm Username"),r.React.createElement(g,{k:"appName",depends:"enabled"},"Application Name"),r.React.createElement(f,{k:"shareName",depends:"enabled"},"Share Username")));const{SET_ACTIVITY:S}=l.findByProps("SET_ACTIVITY"),$="740140397162135563",P="52ffa34ebbd200da17da5a6c3aef1b2e",{store:a}=n.persist,j=setInterval(async()=>{b(await A())},5e3),U=[L(),()=>clearInterval(j),()=>b(void 0)];function b(e){S.handler({isSocketConnected:()=>!0,socket:{id:169,application:{id:$,name:a.appName||"Music"},transport:"ipc"},args:{pid:10,activity:e}})}async function A(){if(!a.enabled){a.status="\u274C Plugin disabled";return}const e=encodeURIComponent(a.username);if(!e){a.status="\u274C Last.fm username required";return}const t=await(await fetch(`https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${e}&api_key=${P}&format=json`)).json();t.error&&(a.status=`\u274C Error from Last.fm: ${t.message}`);const s=t.recenttracks.track[0];if(!s||!s["@attr"]?.nowplaying){a.status="\u23F9\uFE0F Nothing playing";return}a.status=`\u25B6\uFE0F Now playing: ${s.name}`;const c=[];a.shareName&&c.push({label:"Last.fm Profile",url:`https://www.last.fm/user/${e}`}),c.push({label:"View Song",url:s.url});let E="Scrobbling on last.fm";return a.shareName&&(E+=` as ${e}`),{details:s.name,state:`by ${s.artist["#text"]}`,assets:{large_image:s.image[s.image.length-1]["#text"],small_image:"lastfm",large_text:s.album["#text"],small_text:E},buttons:c}}async function B(){a.status="\u{1F551} Waiting for status...",console.log(S)}function M(){w.default.forEachRight(U,e=>e())}return x({enabled:!1,username:"",shareName:!0,appName:"Music"}),o.onLoad=B,o.onUnload=M,o.settings=k,Object.defineProperty(o,"__esModule",{value:!0}),o})({},cumcord.pluginData,cumcord.utils,cumcord.modules.webpack,cumcord.plugins,cumcord.modules.common.React,_,cumcord.patcher,cumcord.modules.common);
